{"version":3,"sources":["../src/editing_actions_ctrl.js"],"names":["showActions","targetOrder","_targetOrder","getProductsAndEquipment","callback","utils","showModal","_tryCatchCounter","tryInitialisingForm","removeListeners","addListeners","setTimeout","initialiseForm","e","closeForm","alert","$","datepicker","orientation","todayBtn","format","autoclose","timepicker","showMeridian","showSeconds","maxHours","minuteStep","secondStep","defaultTime","icons","up","down","instant_search","enableInstantSearch","_products","_equipment","prefill","val","order_id","order_qty","production_line","attr","show","product_id","product_desc","order_date","planned_rate","planned_changeover_time","updateDuration","document","off","on","data","serializeArray","value","submitOrder","inputValues","orderId","orderQty","productionLine","product","date","plannedRate","duration","changeover","startTime","endTime","isValueValid","updateOrder","allData","dp","getData","ordersBeingAffected","getOrdersBeingAffect","_ordersBeingAffected","isLineHavingSpareTimeForTheDay","updateOldAndNewOrders","ordersInOriginalLineAndDate","filter","order","moment","valueOf","isLineChanged","affectedOrders","targetDayStartTime","getLineStartTime","targetDayStartTimeText","nextDayStartTime","add","totalDur","length","isSameOrBefore","all_end_times","map","maxEndTime","Math","max","updateWithRemoving","line","influx","writeLineForUpdateWithRemovingTime","status","post","writeUrl","then","difference","getDiff","updateAffectedOrders","chart","refreshDashboard","catch","updateWithChanging","originalStartTime","changeoverDiff","subtract","oldTotal","newTotal","writeLineForUpdateWithChangingTime","promises","forEach","writeLineForTimeUpdate","prom","push","Promise","all","diff","writeLineForUpdate","cons","STATE_REPLACED","isDateChanged","isTagsChanged","split","dateRegExp","RegExp","prodList","reduce","arr","p","str","id","productionLineList","equ","site","area","findDistinct","indexOf","test","qty","rate","durationHrs","Number","parseFloat","toFixed","momentDuration","durationText","getDurationText","month","get","days","hrs","mins","text","productsUrl","postgRestHost","equipmentsUrl","res","trigger"],"mappings":"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","file":"editing_actions_ctrl.js","sourcesContent":["import * as utils from './utils';\r\nimport * as influx from './influx_helper';\r\nimport * as dp from './data_processor';\r\nimport * as instant_search from './instant_search_ctrl';\r\nimport * as cons from './constans';\r\nimport moment from 'moment';\r\nimport * as chart from './chart_option';\r\n\r\nlet _targetOrder;\r\nlet _ordersBeingAffected;\r\nlet _tryCatchCounter = 1;\r\nlet _products;\r\nlet _equipment;\r\n\r\nconst closeForm = () =>\r\n  $('a#product-schedule-gantt-chart-order-form-close-btn').trigger('click');\r\n\r\n/**\r\n * Show edition order form\r\n * @param {*} targetOrder The order that the user want to make edition on\r\n */\r\nexport function showActions(targetOrder) {\r\n  _targetOrder = targetOrder;\r\n\r\n  //get products data and equipment from postgres database\r\n  getProductsAndEquipment(callback);\r\n\r\n  function callback() {\r\n    utils.showModal('order_form.html', {});\r\n\r\n    //try initialize the form\r\n    _tryCatchCounter = 1;\r\n    tryInitialisingForm();\r\n\r\n    //set listeners\r\n    removeListeners();\r\n    addListeners();\r\n  }\r\n}\r\n\r\nfunction tryInitialisingForm() {\r\n  setTimeout(() => {\r\n    try {\r\n      initialiseForm();\r\n    } catch (e) {\r\n      if (_tryCatchCounter < 15) {\r\n        //maximunm re-init the form over 15 times\r\n        tryInitialisingForm();\r\n        _tryCatchCounter++;\r\n      } else {\r\n        closeForm();\r\n        utils.alert(\r\n          'error',\r\n          'Error',\r\n          'Form initialisation failed, please try agian : ' + e\r\n        );\r\n      }\r\n    }\r\n  }, 200);\r\n}\r\n\r\nfunction initialiseForm() {\r\n  //init datepicker\r\n  $('#datepicker').datepicker({\r\n    orientation: 'top',\r\n    todayBtn: 'linked',\r\n    format: 'yyyy-mm-dd',\r\n    autoclose: true\r\n  });\r\n\r\n  //init timepicker\r\n  $('#changeover-minutes-picker').timepicker({\r\n    showMeridian: false,\r\n    showSeconds: true,\r\n    maxHours: 100,\r\n    minuteStep: 1,\r\n    secondStep: 1,\r\n    defaultTime: '00:00:00',\r\n    icons: {\r\n      up: 'fa fa-chevron-up',\r\n      down: 'fa fa-chevron-down'\r\n    }\r\n  });\r\n\r\n  //init the instant search function\r\n  instant_search.enableInstantSearch(_products, _equipment);\r\n\r\n  //prefill date field and production line\r\n  prefill();\r\n}\r\n\r\nfunction prefill() {\r\n  $('input.prod-sche-gt-chart-datalist-input#order-id').val(\r\n    _targetOrder.order_id\r\n  );\r\n  $('input.prod-sche-gt-chart-datalist-input#order-qty').val(\r\n    _targetOrder.order_qty\r\n  );\r\n  $(\r\n    'input.prod-sche-gt-chart-datalist-input#datalist-input-production-line'\r\n  ).val(_targetOrder.production_line);\r\n  $(\r\n    'input.prod-sche-gt-chart-datalist-input#datalist-input-production-line'\r\n  ).attr('readonly', false);\r\n  $('i.prod-sche-gt-chart-dl-i#datalist-icon').show();\r\n  $('input.prod-sche-gt-chart-datalist-input#datalist-input-products').val(\r\n    _targetOrder.product_id + ' | ' + _targetOrder.product_desc\r\n  );\r\n  $('input.prod-sche-gt-chart-datalist-input#datepicker').val(\r\n    _targetOrder.order_date\r\n  );\r\n  $('input.prod-sche-gt-chart-datalist-input#datepicker').attr(\r\n    'readonly',\r\n    false\r\n  );\r\n  $('input.prod-sche-gt-chart-datalist-input#planned-rate').val(\r\n    _targetOrder.planned_rate\r\n  );\r\n  $('input.prod-sche-gt-chart-datalist-input#changeover-minutes-picker').val(\r\n    _targetOrder.planned_changeover_time\r\n  );\r\n  updateDuration(_targetOrder.order_qty, _targetOrder.planned_rate);\r\n}\r\n\r\nfunction removeListeners() {\r\n  $(document).off('input', 'input#planned-rate, input#order-qty');\r\n  $(document).off(\r\n    'click',\r\n    'button#product-schedule-gantt-chart-order-form-submitBtn'\r\n  );\r\n}\r\n\r\nfunction addListeners() {\r\n  $(document).on('input', 'input#planned-rate, input#order-qty', () => {\r\n    let data = $(\r\n      'form#product-schedule-gantt-chart-order-form'\r\n    ).serializeArray();\r\n    updateDuration(data[1].value, data[5].value);\r\n  });\r\n\r\n  $(document).on(\r\n    'click',\r\n    'button#product-schedule-gantt-chart-order-form-submitBtn',\r\n    e => {\r\n      let data = $(\r\n        'form#product-schedule-gantt-chart-order-form'\r\n      ).serializeArray();\r\n      submitOrder(data);\r\n    }\r\n  );\r\n}\r\n\r\nfunction submitOrder(data) {\r\n  const inputValues = {\r\n    orderId: data[0].value,\r\n    orderQty: data[1].value,\r\n    productionLine: data[2].value,\r\n    product: data[3].value,\r\n    date: data[4].value,\r\n    plannedRate: data[5].value,\r\n    duration: data[6].value,\r\n    changeover: data[7].value,\r\n    startTime: _targetOrder.startTime,\r\n    endTime: _targetOrder.endTime\r\n  };\r\n\r\n  if (isValueValid(inputValues)) {\r\n    updateOrder(inputValues);\r\n  }\r\n}\r\n\r\nfunction updateOrder(inputValues) {\r\n  const allData = dp.getData();\r\n\r\n  //the orders that are in the original line that this order was in and that are being affected because this order changes line\r\n  const ordersBeingAffected = getOrdersBeingAffect(allData, inputValues);\r\n  _ordersBeingAffected = ordersBeingAffected;\r\n\r\n  if (!isLineHavingSpareTimeForTheDay(allData, inputValues, _targetOrder)) {\r\n    utils.alert(\r\n      'warning',\r\n      'Warning',\r\n      \"There is no spare space for this order to fit in this date's schedule\"\r\n    );\r\n    return;\r\n  }\r\n\r\n  // if (isTagsChanged(inputValues)) {\r\n\r\n  updateOldAndNewOrders(inputValues);\r\n\r\n  // }else {\r\n  //   //in here, check if the line has changed, if yes, meaning that the order is going to another line\r\n  //   //so also update all affectingOrders(orders that are in the original line and that are after this order)\r\n  //   if (isLineChanged(inputValues)) {\r\n  //     //save the order directly with removing its starttime and endtime to let the initialiser to init it again\r\n  //     //coz it is changing line, so just simply remove the start time and end time\r\n  //     updateWithRemoving(inputValues)\r\n  //   }else{\r\n  //     if (isDateChanged(inputValues)) {\r\n  //       updateWithRemoving(inputValues)\r\n  //     }else{\r\n  //       //save the order directly with changing its starttime and endtime\r\n  //       updateWithChanging(inputValues)\r\n  //     }\r\n  //   }\r\n  // }\r\n}\r\n\r\n/**\r\n * get alldata and the user input to filter all affected orders.\r\n * These orders will be the ones that are in the original line with the same date.\r\n * @param {*} allData All the orders that is being passed in and displayed in this panel\r\n * @param {*} inputValues Inputs that the user entered in this order edition form\r\n */\r\nfunction getOrdersBeingAffect(allData, inputValues) {\r\n  const ordersInOriginalLineAndDate = allData.filter(\r\n    order =>\r\n      order.production_line === _targetOrder.production_line &&\r\n      order.order_date === _targetOrder.order_date\r\n  );\r\n  return ordersInOriginalLineAndDate.filter(order => {\r\n    let endTime = moment(inputValues.endTime);\r\n    return (\r\n      order.startTime >= endTime.valueOf() &&\r\n      order.order_date === _targetOrder.order_date\r\n    );\r\n  });\r\n}\r\n\r\n/**\r\n * Compares the user input and the original order to see if the line has been changed.\r\n * return true if it is.\r\n * @param {*} inputValues The user input\r\n */\r\nfunction isLineChanged(inputValues) {\r\n  return inputValues.productionLine !== _targetOrder.production_line;\r\n}\r\n\r\nfunction isLineHavingSpareTimeForTheDay(allData, inputValues, targetOrder) {\r\n  //all orders in the targeting line (except the editing order itself (if line not changed))\r\n  let affectedOrders = allData.filter(\r\n    order =>\r\n      order.production_line === inputValues.productionLine &&\r\n      order.order_date === inputValues.date\r\n  );\r\n  affectedOrders = affectedOrders.filter(\r\n    order => order.order_id !== targetOrder.order_id\r\n  );\r\n\r\n  //find the line's default start time and then plus next day\r\n  const targetDayStartTime = moment(\r\n    moment(inputValues.date, 'YYYY-MM-DD').format('YYYY-MM-DD') +\r\n      ' ' +\r\n      utils.getLineStartTime(targetOrder.production_line),\r\n    'YYYY-MM-DD H:mm:ss'\r\n  );\r\n  const targetDayStartTimeText = targetDayStartTime.format(\r\n    'YYYY-MM-DD H:mm:ss'\r\n  );\r\n  const nextDayStartTime = moment(\r\n    targetDayStartTimeText,\r\n    'YYYY-MM-DD H:mm:ss'\r\n  ).add(1, 'days');\r\n\r\n  //calc edited order's duration\r\n  const duration = moment.duration(\r\n    inputValues.orderQty / (inputValues.plannedRate * 60),\r\n    'hours'\r\n  );\r\n  const changeover = moment.duration(inputValues.changeover, 'H:mm:ss');\r\n  const totalDur = duration.add(changeover);\r\n\r\n  //if no affected orders, see if target dat start time + totaldur <= nextdatstarttime\r\n  if (affectedOrders.length === 0) {\r\n    return targetDayStartTime.add(totalDur).isSameOrBefore(nextDayStartTime);\r\n  }\r\n\r\n  //get the max end time\r\n  const all_end_times = affectedOrders.map(order => order.endTime);\r\n  const maxEndTime = moment(Math.max(...all_end_times));\r\n  maxEndTime.add(totalDur);\r\n\r\n  return maxEndTime.isSameOrBefore(nextDayStartTime);\r\n}\r\n\r\n/**\r\n * Take the user input, send request to change the current order to be what the user has entered in the edition form\r\n * It will remove the order's start time and end time because it is changing line so that no order will be affected in the changing line\r\n * and so that the start time and end time can be removed, and then let the initialiser to init the time again.\r\n * @param {*} inputValues The user input\r\n */\r\nfunction updateWithRemoving(inputValues) {\r\n  const line = influx.writeLineForUpdateWithRemovingTime(\r\n    inputValues,\r\n    _targetOrder.status\r\n  );\r\n  utils\r\n    .post(influx.writeUrl, line)\r\n    .then(res => {\r\n      if (_ordersBeingAffected.length > 0) {\r\n        const difference = getDiff(inputValues);\r\n        updateAffectedOrders(inputValues, difference);\r\n      } else {\r\n        closeForm();\r\n        utils.alert(\r\n          'success',\r\n          'Successful',\r\n          'Order has been successfully updated'\r\n        );\r\n        chart.refreshDashboard();\r\n      }\r\n    })\r\n    .catch(e => {\r\n      closeForm();\r\n      utils.alert(\r\n        'error',\r\n        'Error',\r\n        'An error occurred when updated the order : ' + e\r\n      );\r\n    });\r\n}\r\n\r\n/**\r\n * Take the user input, send request to change the current order to be what the user has entered in the edition form\r\n * It normally changes the current order's starttime and endtime because the order is being changed\r\n * @param {*} inputValues User input\r\n */\r\nfunction updateWithChanging(inputValues) {\r\n  const originalStartTime = _targetOrder.startTime;\r\n  //The difference between the original changeover and the edited changeover\r\n  const changeoverDiff = moment\r\n    .duration(inputValues.changeover)\r\n    .subtract(moment.duration(_targetOrder.planned_changeover_time));\r\n  const startTime = moment(originalStartTime).add(changeoverDiff);\r\n  const duration = moment.duration(\r\n    inputValues.orderQty / (inputValues.plannedRate * 60),\r\n    'hours'\r\n  );\r\n  const endTime = moment(originalStartTime)\r\n    .add(changeoverDiff)\r\n    .add(duration);\r\n\r\n  //calc the difference between the edited order's total duration and the original order's total duration\r\n  //so that all the affected orders know how many to add/subtract\r\n  const oldTotal = moment\r\n    .duration(\r\n      _targetOrder.order_qty / (_targetOrder.planned_rate * 60),\r\n      'hours'\r\n    )\r\n    .add(moment.duration(_targetOrder.planned_changeover_time));\r\n  const newTotal = duration.add(moment.duration(inputValues.changeover));\r\n  const difference = oldTotal.subtract(newTotal);\r\n\r\n  const line = influx.writeLineForUpdateWithChangingTime(\r\n    inputValues,\r\n    _targetOrder.status,\r\n    startTime.valueOf(),\r\n    endTime.valueOf()\r\n  );\r\n  utils\r\n    .post(influx.writeUrl, line)\r\n    .then(res => {\r\n      updateAffectedOrders(inputValues, difference);\r\n    })\r\n    .catch(e => {\r\n      closeForm();\r\n      utils.alert(\r\n        'error',\r\n        'Error',\r\n        'An error occurred when updated the order : ' + e\r\n      );\r\n    });\r\n}\r\n\r\n/**\r\n * Take the time difference, send request to add/subtract the time diff for all the affected orders due to -\r\n * the edited order being changed or removed from the current line and date\r\n * @param {*} inputValues The user input\r\n * @param {*} difference The time difference that all affected orders will need to add/subtract\r\n */\r\nfunction updateAffectedOrders(inputValues, difference) {\r\n  let promises = [];\r\n\r\n  _ordersBeingAffected.forEach(order => {\r\n    const line = influx.writeLineForTimeUpdate(order, difference, 'subtract');\r\n    const prom = utils.post(influx.writeUrl, line);\r\n    promises.push(prom);\r\n  });\r\n  Promise.all(promises)\r\n    .then(res => {\r\n      closeForm();\r\n      utils.alert(\r\n        'success',\r\n        'Successful',\r\n        'Order has been successfully updated'\r\n      );\r\n      chart.refreshDashboard();\r\n    })\r\n    .catch(e => {\r\n      closeForm();\r\n      utils.alert(\r\n        'error',\r\n        'Error',\r\n        'An error occurred when updated the order : ' + e\r\n      );\r\n    });\r\n}\r\n\r\n/**\r\n * Take inputValues and find the qty and rate to calc the duration\r\n * then return duration + changeover duration\r\n * @param {*} inputValues User input for the form\r\n */\r\nfunction getDiff(inputValues) {\r\n  let diff;\r\n  const duration = moment.duration(\r\n    inputValues.orderQty / (inputValues.plannedRate * 60),\r\n    'hours'\r\n  );\r\n  const changeover = moment.duration(inputValues.changeover, 'H:mm:ss');\r\n  diff = duration.add(changeover);\r\n  return diff;\r\n}\r\n\r\nfunction updateOldAndNewOrders(inputValues) {\r\n  const line = influx.writeLineForUpdate(cons.STATE_REPLACED, _targetOrder);\r\n  utils\r\n    .post(influx.writeUrl, line)\r\n    .then(res => {\r\n      //save the new order directly with removing its starttime and endtime to let the initialiser to init it again\r\n      //becuase this is the first\r\n      if (isLineChanged(inputValues)) {\r\n        updateWithRemoving(inputValues);\r\n      } else {\r\n        if (isDateChanged(inputValues)) {\r\n          updateWithRemoving(inputValues);\r\n        } else {\r\n          updateWithChanging(inputValues);\r\n        }\r\n      }\r\n    })\r\n    .catch(e => {\r\n      closeForm();\r\n      utils.alert(\r\n        'error',\r\n        'Error',\r\n        'An error occurred when updated the order : ' + e\r\n      );\r\n    });\r\n}\r\n\r\n/**\r\n * Return treu if the user has changed the order date\r\n * @param {*} inputValues The users input for this form editing\r\n */\r\nfunction isDateChanged(inputValues) {\r\n  return inputValues.date !== _targetOrder.order_date;\r\n}\r\n\r\n/**\r\n * Return true if the user has changed tag values (order_id, product_id, product_desc)\r\n * @param {*} inputValues The users input for this form editing\r\n */\r\nfunction isTagsChanged(inputValues) {\r\n  const product_id = inputValues.product.split(' | ')[0];\r\n  const product_desc = inputValues.product.split(' | ')[1];\r\n\r\n  return (\r\n    _targetOrder.order_id !== inputValues.orderId ||\r\n    _targetOrder.product_id !== product_id ||\r\n    _targetOrder.product_desc !== product_desc\r\n  );\r\n}\r\n\r\n/**\r\n * Expect the user inputs\r\n * Check if the user inputs are valid\r\n * Stop and prompt error if the inputs are not valid\r\n * @param {*} data\r\n */\r\nfunction isValueValid(data) {\r\n  const dateRegExp = new RegExp(\r\n    '^[0-9]{4}-(((0[13578]|(10|12))-(0[1-9]|[1-2][0-9]|3[0-1]))|(02-(0[1-9]|[1-2][0-9]))|((0[469]|11)-(0[1-9]|[1-2][0-9]|30)))$'\r\n  );\r\n  const prodList = _products.reduce((arr, p) => {\r\n    const str = p.id + ' | ' + p.product_desc;\r\n    arr.push(str);\r\n    return arr;\r\n  }, []);\r\n\r\n  let productionLineList = _equipment.reduce((arr, equ) => {\r\n    arr.push(equ.site + ' | ' + equ.area + ' | ' + equ.production_line);\r\n    return arr;\r\n  }, []);\r\n  productionLineList = utils.findDistinct(productionLineList);\r\n\r\n  if (data.orderId === '') {\r\n    utils.alert(\r\n      'warning',\r\n      'Warning',\r\n      'Order Number Empty, please enter the Order Number'\r\n    );\r\n    return false;\r\n  }\r\n\r\n  if (data.orderQty === '') {\r\n    utils.alert(\r\n      'warning',\r\n      'Warning',\r\n      'Order Quantity Empty, please enter the Order Quantity'\r\n    );\r\n    return false;\r\n  }\r\n\r\n  if (data.productionLine === '') {\r\n    utils.alert(\r\n      'warning',\r\n      'Warning',\r\n      'Production Line Empty, please enter the Production Line'\r\n    );\r\n    return false;\r\n  } else {\r\n    if (productionLineList.indexOf(data.productionLine) === -1) {\r\n      utils.alert(\r\n        'warning',\r\n        'Warning',\r\n        'Production Line Not Exist, please select a Production Line from the Production Line List'\r\n      );\r\n      return false;\r\n    }\r\n  }\r\n\r\n  if (data.product === '') {\r\n    utils.alert(\r\n      'warning',\r\n      'Warning',\r\n      'Product Empty, please enter the Product'\r\n    );\r\n    return false;\r\n  } else {\r\n    if (prodList.indexOf(data.product) === -1) {\r\n      utils.alert(\r\n        'warning',\r\n        'Warning',\r\n        'Product Not Exist, please select a Product from the Product List'\r\n      );\r\n      return false;\r\n    }\r\n  }\r\n\r\n  if (!dateRegExp.test(data.date)) {\r\n    utils.alert(\r\n      'warning',\r\n      'Warning',\r\n      'Scheduled Start Date Empty or Invalid Date Format, please choose a date from the date picker'\r\n    );\r\n    return false;\r\n  }\r\n\r\n  if (data.plannedRate === '') {\r\n    utils.alert(\r\n      'warning',\r\n      'Warning',\r\n      'Planned Rate Empty, please enter the Planned Rate'\r\n    );\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction updateDuration(qty, rate) {\r\n  if (qty !== '' && rate !== '') {\r\n    let durationHrs =\r\n      Number(parseFloat(qty).toFixed(2)) /\r\n      Number((parseFloat(rate) * 60).toFixed(2));\r\n    let momentDuration = moment.duration(durationHrs, 'hours');\r\n    let durationText = getDurationText(momentDuration);\r\n    $('input.prod-sche-gt-chart-datalist-input#duration').val(durationText);\r\n  } else {\r\n    $('input.prod-sche-gt-chart-datalist-input#duration').val('');\r\n  }\r\n}\r\n\r\nfunction getDurationText(momentDuration) {\r\n  let month = momentDuration.get('month');\r\n  let days = momentDuration.get('d');\r\n  let hrs = momentDuration.get('h');\r\n  let mins = momentDuration.get('minute');\r\n  let text = 'under 1 minute';\r\n\r\n  if (month > 0) {\r\n    return 'Over a month!';\r\n  }\r\n\r\n  if (days !== 0) {\r\n    hrs += days * 24;\r\n  }\r\n\r\n  if (hrs !== 0 && mins !== 0) {\r\n    text = hrs + ' hour(s) & ' + mins + ' minute(s)';\r\n  } else if (hrs !== 0 && mins === 0) {\r\n    text = hrs + ' hour(s)';\r\n  } else if (hrs === 0 && mins !== 0) {\r\n    text = mins + ' minute(s)';\r\n  }\r\n\r\n  return text;\r\n}\r\n\r\n/**\r\n * Get the product list and production line list from postgresql\r\n * Call the callback fn passed in once it is finished\r\n * Stop and prompt error when it fails\r\n * @param {fn} callback\r\n */\r\nfunction getProductsAndEquipment(callback) {\r\n  let productsUrl = utils.postgRestHost + 'product';\r\n  let equipmentsUrl =\r\n    utils.postgRestHost + 'equipment?production_line=not.is.null';\r\n\r\n  utils\r\n    .get(productsUrl)\r\n    .then(res => {\r\n      _products = res;\r\n      utils\r\n        .get(equipmentsUrl)\r\n        .then(res => {\r\n          _equipment = res;\r\n          callback();\r\n        })\r\n        .catch(e => {\r\n          utils.alert(\r\n            'error',\r\n            'Error',\r\n            'An error occurred while fetching data from the postgresql : ' + e\r\n          );\r\n        });\r\n    })\r\n    .catch(e => {\r\n      utils.alert(\r\n        'error',\r\n        'Error',\r\n        'An error occurred while fetching data from the postgresql : ' + e\r\n      );\r\n    });\r\n}\r\n"]}